<%- include('../partials/header.ejs', {cs: 'listStyle'})%>

<div class="container p-3 ">
    <h1>Domicile List</h1>
    <br>
    <%if(domiciles.length){ %>

        <div class="row">
            <!--filter section-->
            <div class="col-lg-3">
                <form action="/domiciles" method="get">
                    <div class="container border text-break sticky-top p-3">
                        <div class="row">
                            <div class="col-md-6">
                                <h1>Filters</h1>
                            </div>
                            <div class="col-md-6 text-end">
                                <a class="btn btn-secondary my-2" href='/domiciles'>Clear Filters</a>

                            </div>
                        </div>
                        
                        <!--accordion to minimize the filtering options-->

                        <div class="accordion" id="filterAccordion">
                            <!--accordion item #1: price filter options-->
                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button 
                                    class="accordion-button collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#priceFilter"
                                    aria-expanded="false"
                                    aria-controls="priceFilter"
                                    >
                                    <strong>Price</strong>
                                    </button>

                                </h3>
                                <div
                                    id="priceFilter"
                                    class="accordion-collapse collapse show"   
                                >
                                        <div class="accordion-body">
                                            
                                            <div class="form-check">
                                                <input class="form-check-input" name="price" type="radio" value="400-600" id="priceOption1"
                                                <% if (filterByPayment && filterByPayment.includes('400-600')) {%>
                                                    checked
                                                <%}%>>
                                                <label class="form-check-label" for="priceOption1">
                                                    $400 - $600
                                                </label>
                                            </div>

                                            <div class="form-check">
                                                <input class="form-check-input" name="price" type="radio" value="1000-1500" id="priceOption2"
                                                <% if (filterByPayment && filterByPayment.includes('1000-1500')) {%>
                                                    checked
                                                <%}%>>
                                                <label class="form-check-label" for="priceOption2">
                                                    $1000 - $1500
                                                </label>
                                            </div> 

                                            <div class="form-check">
                                                <input class="form-check-input" name="price" type="radio" value="1500+" id="priceOption3"
                                                <% if (filterByPayment && filterByPayment.includes('1500+')) {%>
                                                    checked
                                                <%}%>>
                                                <label class="form-check-label" for="priceOption3">
                                                    > $1500
                                                </label>
                                            </div>

                                            
                                        </div>
                                </div>

                            </div>

                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button
                                    class="accordion-button collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#typeFilter"
                                    aria-expanded="false"
                                    aria-controls="typeFilter"
                                    >
                                        <strong>Type</strong>
                                    </button>

                                </h3>
                                <div
                                    id="typeFilter"
                                    class="accordion-collapse collapse show"
                                    
                                >
                                    <div class="accordion-body">
                                        <div class="form-check">
                                            <input class="form-check-input" name="type" type="radio" value="dorm" id="typeOption1"
                                            <% if (filterByType && filterByType.includes('dorm')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="typeOption1">
                                                Dorm
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="type" type="radio" value="apartment" id="typeOption2"
                                            <% if (filterByType && filterByType.includes('apartment')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="typeOption2">
                                                Apartment
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="type" type="radio" value="townhouse" id="typeOption3"
                                            <% if (filterByType && filterByType.includes('townhouse')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="typeOption3">
                                                Townhouse
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--future accordion items-->

                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button
                                    class="accordion-button collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#bedFilter"
                                    aria-expanded="false"
                                    aria-controls="bedFilter"
                                    >
                                        <strong>Beds</strong>
                                    </button>

                                </h3>
                                <div
                                    id="bedFilter"
                                    class="accordion-collapse collapse show"
                                    
                                >
                                    <div class="accordion-body">
                                        <div class="form-check">
                                            <input class="form-check-input" name="bed" type="radio" value="1" id="bedOption1"
                                            <% if (filterByBed && filterByBed.includes('1')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bedOption1">
                                                1
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bed" type="radio" value="2" id="bedOption2"
                                            <% if (filterByBed && filterByBed.includes('2')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bedOption2">
                                                2
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bed" type="radio" value="3" id="bedOption3"
                                            <% if (filterByBed && filterByBed.includes('3')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bedOption3">
                                                3
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bed" type="radio" value="4" id="bedOption4"
                                            <% if (filterByBed && filterByBed.includes('4')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bedOption4">
                                                4
                                            </label>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button
                                    class="accordion-button collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#bathFilter"
                                    aria-expanded="false"
                                    aria-controls="bathFilter"
                                    >
                                        <strong>Baths</strong>
                                    </button>

                                </h3>
                                <div
                                    id="bathFilter"
                                    class="accordion-collapse collapse show"
                                    
                                >
                                    <div class="accordion-body">
                                        <div class="form-check">
                                            <input class="form-check-input" name="bath" type="radio" value="1" id="bathOption1"
                                            <% if (filterByBath && filterByBath.includes('1')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bathOption1">
                                                1
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bath" type="radio" value="1.5" id="bathOption1.5"
                                            <% if (filterByBath && filterByBath.includes('1.5')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bathOption1.5">
                                                1.5
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bath" type="radio" value="2" id="bathOption2"
                                            <% if (filterByBath && filterByBath.includes('2')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bathOption2">
                                                2
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bath" type="radio" value="2.5" id="bathOption2.5"
                                            <% if (filterByBath && filterByBath.includes('2.5')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bathOption2.5">
                                                2.5
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" name="bath" type="radio" value="3" id="bathOption3"
                                            <% if (filterByBath && filterByBath.includes('3')) {%>
                                                checked
                                            <%}%>>
                                            <label class="form-check-label" for="bathOption3">
                                                3
                                            </label>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <input class="btn btn-success my-2" type="submit" value="Submit">

                    </div>

                </form>
            </div>
            

            <!--cards section-->
            <div class="col-lg-9">
                <% if(filterByBath || filterByBed || filterByPayment || filterByType) {%>
                        <!--cards-->
                        <%if(results.length > 0){%>
                            <h3><%=results.length%> posts are currently available</h3>
                            <%results.forEach(domicile=>{%>
                        
                                <div class="cardStyle">
                    
                                    <a href="/domiciles/<%=domicile.id%>">
                                        <div class="card mb-3 bg-light">
                                            <div class="row">
                                            <!--image section-->
                                            <div class="col-lg-4 text-center d-flex justify-content-center">
                                                <!--if there is at least one image in image array, the one at index[0]-->
                                                <!--will be displayed-->
                                                <% if(domicile.image.length > 0){%>
                                                    <img class="img-fluid object-fit-cover" src="data:<%=domicile.image[0].contentType%>;base64,
                                                    <%=domicile.image[0].data.toString('base64')%>"> 
                                                <!--if there is no image provided, default no image is provided-->
                                                <%} else { %>
                                                <img class="img-fluid" src="/images/other/noImageAvailable.png"> 
                                                <%} %>
                                            </div>
                                            <!--domicile information-->
                                            <div class="col-lg-8">
                                                <div class="card-body">
                                                    <h3 class="card-title"><%= domicile.title %></h3>
                                                    <p class="card-text"><%= domicile.address %></p>
                                                    <p class="card-text"><%= domicile.description %></p>
                                                    <p class="card-text">Type: <span class="text-capitalize"><%= domicile.type %></span> | Bed(s): <%= domicile.bed %> | Bath(s): <%= domicile.bath%></p>
                                                    <p class="card-text">$<%= domicile.payment %></p>
                                                    
                                                    <% if(domicile.phone && !domicile.email ) {%>
                                                        <!--if post includes phone number but not email-->
                                                        <p class="card-text"><b>Contact Me:</b> <%= domicile.phone %> </p>
                                                    <% } %>
                                                    
                                                    <% if(!domicile.phone && domicile.email ) {%>
                                                        <!--if post includes email but not phone-->
                                                        <p class="card-text"><b>Contact Me:</b> <%= domicile.email %></p>
                                                    <% } %>
                                                    <% if(domicile.phone && domicile.email ) {%>
                                                        <!--if post includes both email and phone-->
                                                        <p class="card-text"><b>Contact Me:</b> <%= domicile.phone %> | <%= domicile.email %></p>
                                                    <% } %>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                    </a> 
                    
                                </div>
                            <%});%>
                        <% }else{%>
                            <img class="img-fluid" src="/images/other/no_results_found.webp">
                        <%} %>
                <%}else{%>
                    <%domiciles.forEach(domicile=>{%>
                    
                        <div class="cardStyle">

                            <a href="/domiciles/<%=domicile.id%>">
                                <div class="card mb-3 bg-light">
                                    <div class="row">
                                    <!--image section-->
                                    <div class="col-lg-4 text-center d-flex justify-content-center">
                                        <!--if there is at least one image in image array, the one at index[0]-->
                                        <!--will be displayed-->
                                        <% if(domicile.image.length > 0){%>
                                            <img class="img-fluid object-fit-cover" src="data:<%=domicile.image[0].contentType%>;base64,
                                            <%=domicile.image[0].data.toString('base64')%>"> 
                                        <!--if there is no image provided, default no image is provided-->
                                        <%} else { %>
                                        <img class="img-fluid" src="/images/other/noImageAvailable.png"> 
                                        <%} %>
                                    </div>
                                    <!--domicile information-->
                                    <div class="col-lg-8">
                                        <div class="card-body">
                                            <h3 class="card-title"><%= domicile.title %></h3>
                                            <p class="card-text"><%= domicile.address %></p>
                                            <p class="card-text"><%= domicile.description %></p>
                                            <p class="card-text">Type: <span class="text-capitalize"><%= domicile.type %> </span>| Bed(s): <%= domicile.bed %> | Bath(s): <%= domicile.bath%></p>
                                            <p class="card-text">$<%= domicile.payment %></p>
                                            
                                            <% if(domicile.phone && !domicile.email ) {%>
                                                <!--if post includes phone number but not email-->
                                                <p class="card-text"><b>Contact Me:</b> <%= domicile.phone %> </p>
                                            <% } %>
                                            
                                            <% if(!domicile.phone && domicile.email ) {%>
                                                <!--if post includes email but not phone-->
                                                <p class="card-text"><b>Contact Me:</b> <%= domicile.email %></p>
                                            <% } %>
                                            <% if(domicile.phone && domicile.email ) {%>
                                                <!--if post includes both email and phone-->
                                                <p class="card-text"><b>Contact Me:</b> <%= domicile.phone %> | <%= domicile.email %></p>
                                            <% } %>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </a> 

                        </div>

                    <% }); %>
                <%}%>
            </div>
            

        </div>
  
    <%} else {%>
        <h2>There are no domiciles to display</h2>
    <%} %>
</div>

<%- include('../partials/footer.ejs')%>